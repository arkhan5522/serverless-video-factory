name: Transfer Secrets
on: workflow_dispatch

jobs:
  transfer-secrets:
    runs-on: ubuntu-latest
    steps:
      - name: Transfer Secrets
        env:
          # 1. This MUST point to your secret, not a specific text string
          GH_TOKEN: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
          TARGET_REPO: "arkhan5522/serverless-videoo-factory-spanish"

          # 2. Load the secrets into environment variables
          ASSEMBLYAI_API_KEY: ${{ secrets.ASSEMBLYAI_API_KEY }}
          FREEPIK_API_KEY: ${{ secrets.FREEPIK_API_KEY }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          GOOGLE_DRIVE_CREDENTIALS: ${{ secrets.GOOGLE_DRIVE_CREDENTIALS }}
          GOOGLE_DRIVE_FOLDER_ID: ${{ secrets.GOOGLE_DRIVE_FOLDER_ID }}
          KAGGLE_KEY: ${{ secrets.KAGGLE_KEY }}
          KAGGLE_USERNAME: ${{ secrets.KAGGLE_USERNAME }}
          OAUTH_CLIENT_ID: ${{ secrets.OAUTH_CLIENT_ID }}
          OAUTH_CLIENT_SECRET: ${{ secrets.OAUTH_CLIENT_SECRET }}
          OAUTH_REFRESH_TOKEN: ${{ secrets.OAUTH_REFRESH_TOKEN }}
          PEXELS_KEYS: ${{ secrets.PEXELS_KEYS }}
          PIXABAY_KEYS: ${{ secrets.PIXABAY_KEYS }}

        run: |
          # Define the specific list of keys to transfer
          # This prevents the script from trying to upload system vars like CONDA or SHELL
          SECRETS_LIST=(
            "ASSEMBLYAI_API_KEY"
            "FREEPIK_API_KEY"
            "GEMINI_API_KEY"
            "GOOGLE_DRIVE_CREDENTIALS"
            "GOOGLE_DRIVE_FOLDER_ID"
            "KAGGLE_KEY"
            "KAGGLE_USERNAME"
            "OAUTH_CLIENT_ID"
            "OAUTH_CLIENT_SECRET"
            "OAUTH_REFRESH_TOKEN"
            "PEXELS_KEYS"
            "PIXABAY_KEYS"
          )

          for key in "${SECRETS_LIST[@]}"; do
            echo "Transferring: $key"
            val="${!key}"
            
            # Use GitHub CLI to set the secret in the target repo
            gh secret set "$key" --body "$val" --repo "$TARGET_REPO"
          done
